<!DOCTYPE html>
<html lang="sk">
<head>
Â Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MÃ´j doplnkovÃ½ cyklus ğŸ’Š</title>

<!-- iPhone / iPad ikona -->
<link rel="apple-touch-icon" href="./cyklus.png?v=6">
<link rel="apple-touch-icon" sizes="180x180" href="./cyklus.png?v=6">
<link rel="apple-touch-icon" sizes="512x512" href="./cyklus.png?v=6">

<!-- PWA -->
<link rel="manifest" href="./manifest.webmanifest">
<link rel="icon" type="image/png" href="./cyklus.png?v=6">
<meta property="og:image" content="./cyklus.png?v=6">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="DoplnkovÃ½ cyklus">




<!-- Tailwind -->
Â  <script src="https://cdn.tailwindcss.com"></script>
<style>:root { --card-r: 18px; }/* === ZÃ¡klad === */body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial; background: radial-gradient(circle at 50% 0%, #ffffff 0%, #dbeafe 35%, #cbd5e1 100%); color: #111827; overflow-x: hidden; }/* === AplikÃ¡cia === */.app { width: 100%; max-width: 420px; background: rgba(255,255,255,0.92); backdrop-filter: blur(10px) saturate(1.2); border-radius: 22px; border: 1px solid rgba(255,255,255,0.5); box-shadow: 0 8px 25px rgba(0,0,0,0.15), inset 0 1px 2px rgba(255,255,255,0.6); padding: 22px; }/* === LesklÃ© doplnkovÃ© karty === */.supplement-card { position: relative; border-radius: 20px; padding: 16px 18px; margin-bottom: 14px; display: flex; justify-content: space-between; align-items: center; overflow: hidden; transform: translateZ(0); box-shadow: inset 0 1px 2px rgba(255,255,255,0.6), 0 6px 14px rgba(0,0,0,0.25); transition: transform .2s ease, box-shadow .2s ease; }.supplement-card:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }/* ÄŒervenÃ¡ / zelenÃ¡ pre striedanie */.supplement-card:nth-child(odd) { background: linear-gradient(180deg, #ff5252 0%, #c80000 60%, #5a0000 100%); } .supplement-card:nth-child(even) { background: linear-gradient(180deg, #4dff91 0%, #00b35a 60%, #005a2e 100%); } 
/* NOVÃ‰ Å TÃLY PRE CYKLY */
.supplement-card.warn {
    /* Å½ltÃ©/oranÅ¾ovÃ© upozornenie */
    background: linear-gradient(180deg, #ffcc00 0%, #ff9900 60%, #cc7a00 100%);
    box-shadow: inset 0 1px 2px rgba(255,255,255,0.8), 0 6px 14px rgba(0,0,0,0.35);
}
.supplement-card.pause {
    /* Å edÃ© pre pauzu */
    background: linear-gradient(180deg, #9ca3af 0%, #4b5563 60%, #1f2937 100%);
    box-shadow: inset 0 1px 2px rgba(255,255,255,0.4), 0 6px 14px rgba(0,0,0,0.15);
}
.supplement-card.pause:hover { transform: none; box-shadow: inset 0 1px 2px rgba(255,255,255,0.4), 0 6px 14px rgba(0,0,0,0.15); }
.supplement-card.pause::before { opacity: 0.1; animation: none; }
.pause-message {
    color: #fff;
    font-weight: 600;
    font-size: 0.9rem;
    padding-left: 10px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.4);
    text-align: right;
    z-index: 2; /* nad prelivom */
}
.supplement-card.warn .left .name, .supplement-card.warn .dose-label { color: #333; text-shadow: none; }
/* Koniec NOVÃCH Å TÃLOV */

/* SvetelnÃ½ preliv ako na aute */.supplement-card::before { content: ""; position: absolute; inset: 0; background: linear-gradient(120deg, rgba(255,255,255,0.8) 0%, transparent 40%, transparent 60%, rgba(255,255,255,0.25) 100%); opacity: 0.6; mix-blend-mode: screen; transform: translateX(-100%); animation: shineSweep 6s linear infinite; } @keyframes shineSweep { 0% { transform: translateX(-100%); opacity: 0.0; } 40% { opacity: 0.8; } 60% { opacity: 0.8; } 100% { transform: translateX(120%); opacity: 0.0; } } /* Text v kartÃ¡ch */.left { display: flex; flex-direction: column; gap: 6px; z-index: 2; } .left .name { font-weight: 800; font-size: 1.05rem; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.4); } /* DÃ¡vkovacie Å¡tÃ­tky */.dose-label { display: inline-block; margin: 3px 5px 0 0; padding: 4px 9px; border-radius: 10px; font-size: 0.78rem; font-weight: 600; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.3); box-shadow: inset 0 1px 2px rgba(255,255,255,0.5), 0 2px 4px rgba(0,0,0,0.2); } .dose-label.green { background: linear-gradient(180deg, #38ef7d 0%, #11998e 100%); } .dose-label.blue { background: linear-gradient(180deg, #56ccf2 0%, #2f80ed 100%); } .dose-label.orange{ background: linear-gradient(180deg, #f7971e 0%, #ffd200 100%); color:#222; text-shadow:none; } .dose-label.gray { background: linear-gradient(180deg, #d1d5db 0%, #9ca3af 100%); color:#222; } /* PravÃ¡ ÄasÅ¥ (ikony a Äasy) */.right { display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-end; z-index: 2; } .time-chip { display: inline-flex; align-items: center; font-size: 0.8rem; background: #fff; border-radius: 8px; padding: 3px 7px; border: 1px solid rgba(0,0,0,0.15); box-shadow: inset 0 1px 2px rgba(255,255,255,0.8); } /* Ikony vpravo */.right .icon { font-size: 20px; color: #fff; opacity: .9; text-shadow: 0 2px 3px rgba(0,0,0,0.6); transition: transform .2s ease; } .right .icon:hover { transform: scale(1.2); opacity: 1; } /* === SpodnÃ© tlaÄidlÃ¡ === */button { font-weight: 700; border: none; border-radius: 14px; position: relative; overflow: hidden; transition: all 0.15s ease-in-out; box-shadow: inset 0 1px 0 rgba(255,255,255,0.6), 0 3px 10px rgba(0,0,0,0.25); } button::before { content: ""; position: absolute; inset: 0; background: linear-gradient(120deg, rgba(255,255,255,0.6) 0%, transparent 50%, rgba(255,255,255,0.2) 100%); opacity: .5; transform: translateX(-100%); animation: shineSweep 8s linear infinite; pointer-events: none; } #addSupplement { background: linear-gradient(180deg, #4e9fff 0%, #2563eb 55%, #153aa8 100%); color: white; } #resetAll { background: linear-gradient(180deg, #ff5656 0%, #c90000 55%, #7a0000 100%); color: white; } #enableNotifs { background: linear-gradient(180deg, #4dff91 0%, #00c24b 55%, #006b2e 100%); color: white; } #addSupplement:hover,#resetAll:hover,#enableNotifs:hover { transform: scale(1.02); box-shadow: 0 5px 16px rgba(0,0,0,0.3); } /* === KruhovÃ½ graf === */ #progressCircle { filter: drop-shadow(0 0 8px rgba(59,130,246,0.5)) drop-shadow(0 0 8px rgba(22,163,74,0.4)); } #progressLabel { font-weight: 800; fill: url(#grad); text-shadow: 0 0 8px rgba(0,0,0,0.25); } svg circle:first-of-type { stroke: #e5e7eb; opacity: .5; } /* === PÃ´vodnÃ© pill style upravenÃ© pre novÃ½ dizajn === */ .pill.dosage { /* ZelenÃ¡ farba pre hotovÃ© dÃ¡vky/dÃ¡vkovanie */ color: #034b28; background: linear-gradient(180deg, #caffdd 0%, #9bf2bf 60%, #5ddf96 100%); box-shadow: inset 0 1px 2px rgba(255,255,255,0.7), 0 1px 3px rgba(0,0,0,0.1); } .pill.time { /* ÄŒervenÃ¡ farba pre ÄakajÃºce Äasy */ color: #5f0b0b; background: linear-gradient(180deg, #ffe0e0 0%, #ffc5c5 60%, #ffaaaa 100%); box-shadow: inset 0 1px 2px rgba(255,255,255,0.7), 0 1px 3px rgba(0,0,0,0.1); } /* === NOVÃ Å TÃL PRE ZVÃRAZNENIE DÅ‡A === */ .day-cell-compact { cursor: default; box-shadow: 0 1px 3px rgba(0,0,0,0.1); } .day-cell-compact.bg-indigo-600 { background-color: #4f46e5; color: white; font-weight: 700; transform: scale(1.02); box-shadow: 0 4px 6px rgba(0,0,0,0.2); } </style>
</head>
<body class="flex flex-col items-center p-4">
Â  <!-- HlaviÄka -->
Â  <img src="./apple-touch-icon.png" alt="Doplnky" class="w-20 h-20 rounded-full shadow-md mb-2">

Â  <h1 class="text-2xl font-extrabold mb-3 text-center">ğŸ’Š MÃ´j doplnkovÃ½ cyklus</h1>
Â  <div class="app">
Â  Â  <!-- Zoznam doplnkov -->
Â  Â  <div id="supplementList" class="mb-4"></div>
Â  Â  <!-- Pridanie doplnku -->
Â  Â  <div class="flex gap-2 mb-2">
Â  Â  Â  <input id="newSupplement" type="text" placeholder="NÃ¡zov doplnkuâ€¦"
Â  Â  Â  Â  Â  Â  Â class="flex-1 border border-gray-300 rounded-lg px-3 py-2">
Â  Â  Â  <button id="addSupplement"
Â  Â  Â  Â  Â  Â  Â  class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700">PridaÅ¥</button>
Â  Â  </div>
Â  Â  <button id="resetAll" class="w-full bg-red-500 text-white rounded-lg py-2 mt-2 hover:bg-red-600" data-confirm="false">ğŸ” ResetovaÅ¥ dÃ¡ta</button>
Â  Â  <button id="enableNotifs" class="w-full bg-green-500 text-white rounded-lg py-2 mt-2 hover:bg-green-600">ğŸ”” PovoliÅ¥ notifikÃ¡cie</button>
Â  Â  <!-- DennÃ½ status + graf -->
Â  Â  <div class="bg-white rounded-2xl p-5 mt-4 border">
Â  Â  Â  <!-- NOVÃ SEKCIA: VizuÃ¡lny displej aktuÃ¡lneho dÅˆa -->
Â  Â  Â  <h3 class="text-sm text-gray-600 mb-2 font-semibold">AktuÃ¡lny deÅˆ:</h3>
Â  Â  Â  <div id="dayDisplay" class="grid grid-cols-7 gap-1.5 mb-4 text-xs font-semibold text-center">
Â  Â  Â  Â  <!-- Dni budÃº vloÅ¾enÃ© cez JS s automatickÃ½m zvÃ½raznenÃ­m -->
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  <p id="dayStatus" class="text-sm text-gray-600 mb-3 font-medium"></p>
Â  Â  Â  <div class="flex items-center justify-center">
Â  Â  Â  Â  <svg width="164" height="164" viewBox="0 0 120 120">
Â  Â  Â  Â  Â  <defs>
Â  Â  Â  Â  Â  Â  <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
Â  Â  Â  Â  Â  Â  Â  <stop offset="0%"Â  stop-color="#2563eb"/>
Â  Â  Â  Â  Â  Â  Â  <stop offset="100%" stop-color="#16a34a"/>
Â  Â  Â  Â  Â  Â  </linearGradient>
Â  Â  Â  Â  Â  </defs>
Â  Â  Â  Â  Â  <circle cx="60" cy="60" r="54" stroke="#e5e7eb" stroke-width="10" fill="none"/>
Â  Â  Â  Â  Â  <circle id="progressCircle" cx="60" cy="60" r="54"
Â  Â  Â  Â  Â  Â  Â  Â  Â  stroke="url(#grad)" stroke-width="10" fill="none"
Â  Â  Â  Â  Â  Â  Â  Â  Â  stroke-linecap="round"
Â  Â  Â  Â  Â  Â  Â  Â  Â  stroke-dasharray="339.292" stroke-dashoffset="339.292"
Â  Â  Â  Â  Â  Â  Â  Â  Â  transform="rotate(-90 60 60)"/>
Â  Â  Â  Â  Â  <text id="progressLabel" x="50%" y="50%" text-anchor="middle" dy="6" font-size="16" class="fill-gray-800">0%</text>
Â  Â  Â  Â  </svg>
Â  Â  Â  </div>
Â  Â  Â  <div id="todayChips" class="mt-3 flex flex-wrap gap-2"></div>
Â  Â  </div>
Â  </div>
Â  <!-- MODAL â€“ PlÃ¡n -->
Â  <div id="planModal" class="hidden fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4">
Â  Â  <div class="bg-white rounded-2xl shadow-2xl p-6 w-96 max-w-full">
Â  Â  Â  <h2 id="modalTitle" class="text-lg font-bold mb-4 text-center">ğŸ•“ PlÃ¡n uÅ¾Ã­vania </h2>
Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <h3 class="font-semibold mb-2">ğŸ“… Dni v tÃ½Å¾dni</h3>
Â  Â  Â  Â  Â  <div id="dayChecks" class="grid grid-cols-7 gap-2 text-sm"></div>
Â  Â  Â  Â  </div>
        <!-- NOVÃ‰ POLE: KonfigurÃ¡cia cyklu -->
        <div id="cycleConfigFields" class="border p-3 rounded-lg bg-gray-50 hidden">
            <h3 class="font-semibold mb-2 text-indigo-700">ğŸ”„ Cyklovanie (NastavenÃ© automaticky)</h3>
            <div class="flex gap-2">
                <div class="flex-1">
                    <label class="text-xs text-gray-500 block">DÄºÅ¾ka cyklu (tÃ½Å¾dne):</label>
                    <input id="cycleDuration" type="number" min="1" class="w-full border rounded-lg px-2 py-1" disabled>
                </div>
                <div class="flex-1">
                    <label class="text-xs text-gray-500 block">DÄºÅ¾ka pauzy (tÃ½Å¾dne):</label>
                    <input id="cyclePause" type="number" min="1" class="w-full border rounded-lg px-2 py-1" disabled>
                </div>
            </div>
            <p id="cycleStatusMsg" class="text-sm mt-2 text-red-500 font-medium"></p>
        </div>
        <!-- Koniec NOVÃ‰HO POÄ½A -->
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <h3 class="font-semibold mb-2">â° ÄŒasy (hh:mm)</h3>
Â  Â  Â  Â  Â  <div id="timeList" class="space-y-2"></div>
Â  Â  Â  Â  Â  <button id="addTime" class="mt-2 px-3 py-1 rounded-lg border border-gray-300 text-sm hover:bg-gray-50">+ pridaÅ¥ Äas</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="flex gap-2 pt-1">
Â  Â  Â  Â  Â  <button id="savePlan" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">ğŸ’¾ UloÅ¾iÅ¥ plÃ¡n</button>
Â  Â  Â  Â  Â  <button id="closePlan" class="flex-1 bg-gray-400 text-white py-2 rounded-lg hover:bg-gray-500">ZavrieÅ¥</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
Â  <script>
Â  Â  /* ---------- helpers ---------- */
Â  Â  const $ = s => document.querySelector(s);
Â  Â  const $$ = s => [...document.querySelectorAll(s)];
Â  Â  const dayShorts = ["Po","Ut","St","Å t","Pi","So","Ne"];
Â  Â  const dayLongs = ["Pondelok", "Utorok", "Streda", "Å tvrtok", "Piatok", "Sobota","NedeÄ¾a"];
Â  Â  const todayISO = () => new Date().toISOString().slice(0,10);
Â  Â  const todayShort = () => dayShorts[(new Date().getDay()+6)%7]; // Po=0, ..., Ne=6
Â  Â  const readLS = (k,d)=>{ try{ return JSON.parse(localStorage.getItem(k)) ?? d; }catch{ return d } };
Â  Â  const writeLS = (k,v)=> localStorage.setItem(k, JSON.stringify(v));
Â  Â const doseContexts = [
Â  "rÃ¡no", "pred raÅˆajkami", "po raÅˆajkÃ¡ch",
Â  "pred obedom", "po obede",
Â  "pred trÃ©ningom", "po trÃ©ningu",
Â  "veÄer", "pred spanÃ­m",
Â  "pred jedlom", "po jedle",
Â  "kedykoÄ¾vek (s jedlom)", "kedykoÄ¾vek (nalaÄno)"
];

Â  Â  // Doplnky s novÃ½mi cyklami
Â  Â  const defaultSupplements = [
Â  Â  Â  { 
          name: "Ecdysterone",Â  
          doseQuantity: "1 kapsula", 
          doseContext: "po raÅˆajkÃ¡ch", 
          plan:{days:["Po","Ut","St","Å t","Pi","So","Ne"], times:["08:30"]},
          cycleConfig: { durationWeeks: 12, pauseWeeks: 4 } // 12 tÃ½Å¾dÅˆov ON / 4 tÃ½Å¾dne OFF
      },
Â  Â  Â  { 
          name: "KreatÃ­n",Â  Â  Â  
          doseQuantity: "3 kapsuly", 
          doseContext: "po raÅˆajkÃ¡ch, alebo pred trÃ©ningom", 
          plan:{days:["Po","Ut","St","Å t","Pi","So","Ne"], times:["08:30"]},
          cycleConfig: { durationWeeks: 10, pauseWeeks: 4 } // 10 tÃ½Å¾dÅˆov ON / 4 tÃ½Å¾dne OFF
      },
Â  Â  Â  { name: "L-Lysine",Â  Â  Â doseQuantity: "1 tabletka", doseContext: "pred raÅˆajkami", plan:{days:["Po","Ut","St","Å t","Pi","So","Ne"], times:["08:00"]}, cycleConfig: { durationWeeks: 0, pauseWeeks: 0 } },
Â  Â  Â  { 
          name: "NMN",Â  Â  Â  Â  Â  
          doseQuantity: "1 kapsula", 
          doseContext: "pred raÅˆajkami", 
          plan:{days:["Po","Ut","St","Å t","Pi"], times:["08:00"]}, // UÅ¾Ã­vanie len Po-Pi
          cycleConfig: { durationWeeks: 0, pauseWeeks: 0 } // Logika v getCycleStatus
      },
Â  Â  Â  { name: "Ashwagandha",Â  doseQuantity: "1 kapsula", doseContext: "po raÅˆajkÃ¡ch,1 kapsula hodinu pred spanÃ­m", plan:{days:["Po","Ut","St","Å t","Pi","So","Ne"], times:["08:30", "20:30"]}, cycleConfig: { durationWeeks: 0, pauseWeeks: 0 } },
Â  Â  Â  { name: "Moringa",Â  Â  Â  doseQuantity: "3 kapsuly", doseContext: "po raÅˆajkÃ¡ch", plan:{days:["Po","Ut","St","Å t","Pi","So","Ne"], times:["08:30"]}, cycleConfig: { durationWeeks: 0, pauseWeeks: 0 } },
Â  Â  Â  { name: "Omega-3",Â  Â  Â  doseQuantity: "1 kapsula", doseContext: "po raÅˆajkÃ¡ch", plan:{days:["Po","Ut","St","Å t","Pi","So","Ne"], times:["08:30"]}, cycleConfig: { durationWeeks: 0, pauseWeeks: 0 } },
Â  Â  Â  { name: "Move Free Joint Health",Â  Â  Â  doseQuantity: "1 kapsula", doseContext: "po raÅˆajkÃ¡ch, 1 kapsula po obede,1 kapsula hodinu pred spanÃ­m", plan:{days:["Po","Ut","St","Å t","Pi","So","Ne"], times:["08:30","14:00","20:30"]}, cycleConfig: { durationWeeks: 0, pauseWeeks: 0 } }
Â  Â  ];
Â  Â  let supplements = readLS('supplements', defaultSupplements);
Â  Â  let historyÂ  Â  Â = readLS('history', {});
    
    // Nastavenie poÄiatoÄnÃ½ch hodnÃ´t (startDate, cycleConfig) pre starÃ© zÃ¡znamy
    function initializeSupplements() {
        supplements.forEach(s => {
            if (!s.startDate) {
                s.startDate = todayISO();
            }
            if (!s.cycleConfig || s.cycleConfig.durationWeeks === undefined) {
                // Pokus nÃ¡jsÅ¥ default config
                const defaultConfig = defaultSupplements.find(d => d.name === s.name);
                s.cycleConfig = defaultConfig?.cycleConfig || { durationWeeks: 0, pauseWeeks: 0 };
            }
        });
        writeLS('supplements', supplements);
    }

Â  Â  /* ---------- UI refs ---------- */
Â  Â  const listElÂ  Â = $('#supplementList');
Â  Â  const addElÂ  Â  = $('#newSupplement');
Â  Â  const btnAddÂ  Â = $('#addSupplement');
Â  Â  const btnReset = $('#resetAll');
Â  Â  const btnNotif = $('#enableNotifs');
Â  Â  const dayStatus = $('#dayStatus');
Â  Â  const progressCircle = $('#progressCircle');
Â  Â  const progressLabelÂ  = $('#progressLabel');
Â  Â  const todayChips = $('#todayChips');
Â  Â  const dayDisplay = $('#dayDisplay'); 
Â  Â  const planModal = $('#planModal');
Â  Â  const modalTitle= $('#modalTitle');
Â  Â  const dayChecks = $('#dayChecks');
Â  Â  const timeListÂ  = $('#timeList');
Â  Â  const btnAddTime= $('#addTime');
Â  Â  const btnSavePlan=$('#savePlan');
Â  Â  const btnClosePlan=$('#closePlan');
    const cycleConfigFields = $('#cycleConfigFields'); // NovÃ½ ref
    const cycleDuration = $('#cycleDuration'); // NovÃ½ ref
    const cyclePause = $('#cyclePause'); // NovÃ½ ref
    const cycleStatusMsg = $('#cycleStatusMsg'); // NovÃ½ ref

Â  Â  let editingIndex = -1;
    
    /* ---------- Cycle Logic (NEW) ---------- */
    // Vracia status a sprÃ¡vu o cykle
    function getCycleStatus(supp) {
        const todayDayIndex = new Date().getDay(); // 0=NedeÄ¾a, 1=Pondelok, ..., 6=Sobota

        // 1. NMN VÃKEND PAUZA (Logika aj pre dni, ktorÃ© nie sÃº v plÃ¡ne)
        if (supp.name === "NMN") {
            if (todayDayIndex === 0 || todayDayIndex === 6) { // NedeÄ¾a alebo Sobota
                return { status: 'PAUSE', message: "VÃ­kendovÃ¡ pauza. UÅ¾Ã­vanie sa obnovÃ­ v pondelok." };
            }
        }
        
        // Ak doplnok nemÃ¡ definovanÃ½ dlhÃ½ cyklus, je vÅ¾dy ON (okrem NMN)
        if (!supp.cycleConfig || supp.cycleConfig.durationWeeks === 0) {
            return { status: 'ON', message: '' };
        }

        const start = new Date(supp.startDate);
        const now = new Date();
        const diffTime = Math.abs(now - start);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        const daysInCycle = supp.cycleConfig.durationWeeks * 7;
        const daysInPause = supp.cycleConfig.pauseWeeks * 7;
        const totalCycleDays = daysInCycle + daysInPause;

        // VypoÄÃ­ta dni uplynulÃ© od zaÄiatku celÃ©ho bloku (cyklus + pauza)
        const daysIntoCurrentBlock = diffDays % totalCycleDays; 
        
        const daysLeftInCycle = daysInCycle - daysIntoCurrentBlock;
        const daysLeftInPause = totalCycleDays - daysIntoCurrentBlock;

        // PAUZA fÃ¡za
        if (daysIntoCurrentBlock >= daysInCycle) {
            const daysIntoPause = daysIntoCurrentBlock - daysInCycle;
            return { 
                status: 'PAUSE', 
                message: `POVINNÃ PAUZA (${supp.cycleConfig.pauseWeeks} tÃ½Å¾dÅˆov). ZostÃ¡va: ${daysLeftInPause} dnÃ­.` 
            };
        }
        
        // Cyklus ON fÃ¡za
        if (daysIntoCurrentBlock < daysInCycle) {
            // UPOZORNENIE: Ak zostÃ¡va 7 dnÃ­ alebo menej
            if (daysLeftInCycle <= 7) {
                return { 
                    status: 'WARN', 
                    message: `âš ï¸ Cyklus konÄÃ­ o ${daysLeftInCycle} dnÃ­. Nasleduje ${supp.cycleConfig.pauseWeeks} tÃ½Å¾dÅˆov pauza.` 
                };
            }
            const weeksLeft = Math.ceil(daysLeftInCycle / 7);
            return { 
                status: 'ON', 
                message: `Cyklus: ${supp.cycleConfig.durationWeeks} tÃ½Å¾dÅˆov. ZostÃ¡va: ${weeksLeft} tÃ½Å¾dÅˆov.` 
            };
        }
        
        // Default (nemalo by sa staÅ¥)
        return { status: 'ON', message: '' };
    }

Â  Â  /* ---------- render list (with glossy cards) ---------- */
Â  Â  function renderSupplements(){
Â  Â  Â  listEl.innerHTML = "";
Â  Â  Â  supplements.forEach((supp,i)=>{
          const cycleStatus = getCycleStatus(supp);
          const isPaused = cycleStatus.status === 'PAUSE';
          const isWarning = cycleStatus.status === 'WARN';

Â  Â  Â  Â  const isToday = supp.plan.days.includes(todayShort());
Â  Â  Â  Â  const timesToday = isToday ? [...supp.plan.times].sort() : [];
Â  Â  Â  Â  const row = document.createElement('div');
Â  Â  Â  Â  
        let cardClass = "";
        if (isPaused) cardClass = "pause";
        else if (isWarning) cardClass = "warn";
        else cardClass = i % 2 === 0 ? "odd" : "even";

Â  Â  Â  Â  row.className = `supplement-card ${cardClass}`;
        
Â  Â  Â  Â  const left = document.createElement('div');
Â  Â  Â  Â  left.className = "left";

Â  Â  Â  Â  let dosageText = "";
Â  Â  Â  Â  let dosageClass = "green"; 
Â  Â  Â  Â  const quantity = supp.doseQuantity || "1 ks";
Â  Â  Â  Â  const context = supp.doseContext || "rÃ¡no";
Â  Â  Â  Â  dosageText = `${quantity} ${context}`;

Â  Â  Â  Â  if (context.includes("raÅˆajkami") || context.includes("rÃ¡no")) {
Â  Â  Â  Â  Â  dosageClass = "orange";
Â  Â  Â  Â  } else if (context.includes("obed") || context.includes("trÃ©ningom")) {
Â  Â  Â  Â  Â  dosageClass = "blue";
Â  Â  Â  Â  } else if (context.includes("veÄer") || context.includes("spanÃ­m")) {
Â  Â  Â  Â  Â  dosageClass = "green";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  dosageClass = "gray";
Â  Â  Â  Â  }

Â  Â  Â  Â  left.innerHTML =
Â  Â  Â  Â  Â  `<span class="name">${supp.name}</span>
Â  Â  Â  Â  Â  ${dosageText ? `<span class="dose-label ${dosageClass}">${dosageText}</span>` : ''}`
Â  Â  Â  Â  ;
Â  Â  Â  Â  row.appendChild(left);
        
Â  Â  Â  Â  const right = document.createElement('div');
Â  Â  Â  Â  right.className = isPaused ? "flex items-center" : "right";

        if (isPaused) {
            // Ak je pauza, zobrazÃ­me len sprÃ¡vu
            const msgEl = document.createElement('div');
            msgEl.className = "pause-message text-sm text-right";
            msgEl.innerHTML = `PAUZA<br>${cycleStatus.message.replace('POVINNÃ PAUZA: ', '')}`;
            right.appendChild(msgEl);
            // PridÃ¡me tlaÄidlo PlÃ¡n, ale nie checkbox ani del
            const planBtn = document.createElement('button');
Â  Â  Â  Â  Â  Â  planBtn.className = "icon"; planBtn.title = "PlÃ¡n uÅ¾Ã­vania"; planBtn.textContent = "ğŸ•“";
Â  Â  Â  Â  Â  Â  planBtn.onclick = ()=> openPlan(i);
Â  Â  Â  Â  Â  Â  right.appendChild(planBtn);
        } else {
            // Ak nie je pauza, zobrazÃ­me Äasy a tlaÄidlÃ¡
            timesToday.forEach(t=>{
                const checked = !!(history[todayISO()] && history[todayISO()][supp.name] && history[todayISO()][supp.name][t]);
                const wrap = document.createElement('label');
                wrap.className = "time-chip";
                wrap.innerHTML = `<input type="checkbox" class="accent-blue-600 time-taken" data-name="${supp.name}" data-time="${t}" ${checked?'checked':''}> ${t}`;
                right.appendChild(wrap);
            });
            
            // PridÃ¡me upozornenie, ak je WARN
            if (isWarning) {
                 const warnEl = document.createElement('span');
                 warnEl.className = "pause-message text-xs text-center w-full";
                 warnEl.textContent = cycleStatus.message;
                 right.appendChild(warnEl);
            }

            const planBtn = document.createElement('button');
Â  Â  Â  Â  Â  Â  planBtn.className = "icon"; planBtn.title = "PlÃ¡n uÅ¾Ã­vania"; planBtn.textContent = "ğŸ•“";
Â  Â  Â  Â  Â  Â  planBtn.onclick = ()=> openPlan(i);
Â  Â  Â  Â  Â  Â  right.appendChild(planBtn);
        }
        
Â  Â  Â  Â  const delBtn = document.createElement('button');
Â  Â  Â  Â  delBtn.className = "icon"; delBtn.title = "OdstrÃ¡niÅ¥"; delBtn.textContent = "âœ–";
Â  Â  Â  Â  delBtn.onclick = ()=>{ supplements.splice(i,1); writeLS('supplements',supplements); renderAll(); };
Â  Â  Â  Â  right.appendChild(delBtn);
        
Â  Â  Â  Â  row.appendChild(right);
Â  Â  Â  Â  listEl.appendChild(row);
Â  Â  Â  });
Â  Â  Â  $$('.time-taken').forEach(inp=>{
Â  Â  Â  Â  inp.addEventListener('change', e=>{
Â  Â  Â  Â  Â  const n = e.target.dataset.name;
Â  Â  Â  Â  Â  const t = e.target.dataset.time;
Â  Â  Â  Â  Â  if(!history[todayISO()]) history[todayISO()] = {};
Â  Â  Â  Â  Â  if(!history[todayISO()][n]) history[todayISO()][n] = {};
Â  Â  Â  Â  Â  history[todayISO()][n][t] = e.target.checked;
Â  Â  Â  Â  Â  writeLS('history', history);
Â  Â  Â  Â  Â  renderAll(false);
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }
Â  Â  /* ---------- planner modal ---------- */
Â  Â  function openPlan(index){
Â  Â  Â  editingIndex = index;
Â  Â  Â  const supp = supplements[index];
Â  Â  Â  // ZmenenÃ½ nÃ¡zov modalu, keÄÅ¾e uÅ¾ neobsahuje dÃ¡vkovanie
Â  Â  Â  modalTitle.textContent = `ğŸ•“ ${supp.name} â€“ Nastavenie cyklu (Dni & ÄŒasy)`;
Â  Â  Â  
        // Zobrazenie/skrytie polÃ­ cyklovania
        if (supp.cycleConfig && supp.cycleConfig.durationWeeks > 0) {
            cycleConfigFields.classList.remove('hidden');
            cycleDuration.value = supp.cycleConfig.durationWeeks;
            cyclePause.value = supp.cycleConfig.pauseWeeks;
            // Zobrazenie dÃ¡tumu zaÄiatku
            cycleStatusMsg.textContent = `ZaÄiatok cyklu: ${supp.startDate}. Cyklus sa opakuje automaticky.`;
        } else {
            cycleConfigFields.classList.add('hidden');
        }

Â  Â  Â  dayChecks.innerHTML = "";
Â  Â  Â  dayShorts.forEach(d=>{
Â  Â  Â  Â  const lab = document.createElement('label');
Â  Â  Â  Â  lab.className = "flex flex-col items-center gap-1 text-sm bg-gray-50 p-1 rounded-lg cursor-pointer hover:bg-gray-100";
Â  Â  Â  Â  const id = `d-${d}`;
Â  Â  Â  Â  lab.innerHTML = `<input type="checkbox" id="${id}" value="${d}" class="accent-blue-600" ${supp.plan.days.includes(d)?'checked':''}><span>${d}</span>`;
Â  Â  Â  Â  dayChecks.appendChild(lab);
Â  Â  Â  });
Â  Â  Â  timeList.innerHTML = "";
Â  Â  Â  // ZabezpeÄÃ­me, Å¾e existuje aspoÅˆ jeden Äas
Â  Â  Â  (supp.plan.times.length ? supp.plan.times : ["08:30"]).sort().forEach(addTimeRow);
Â  Â  Â  planModal.classList.remove('hidden');
Â  Â  }
Â  Â  function addTimeRow(value="08:30"){
Â  Â  Â  const w = document.createElement('div');
Â  Â  Â  w.className = "flex items-center gap-2";
Â  Â  Â  w.innerHTML =
Â  Â  Â  Â  `<input type="time" value="${value}" class="time-input border rounded-lg px-3 py-1 flex-1">
Â  Â  Â  Â  <button class="px-2 py-1 rounded-lg border border-gray-300 text-red-500 hover:bg-red-50 remove-time">âœ–</button>`
Â  Â  Â  ;
Â  Â  Â  timeList.appendChild(w);
Â  Â  Â  w.querySelector('.remove-time').onclick = ()=> w.remove();
Â  Â  }
Â  Â  btnAddTime.onclick = ()=> addTimeRow();
Â  Â  btnSavePlan.onclick = ()=>{
Â  Â  Â  if(editingIndex<0) return;

Â  Â  Â  const daysSel = [...dayChecks.querySelectorAll('input[type="checkbox"]:checked')].map(i=>i.value);
Â  Â  Â  const timesSel= [...timeList.querySelectorAll('.time-input')].map(i=>i.value).filter(Boolean).sort();
Â  Â  Â  
Â  Â  Â  supplements[editingIndex].plan = { days: daysSel, times: timesSel.length? timesSel : ["08:30"] };
Â  Â  Â  writeLS('supplements', supplements);
Â  Â  Â  planModal.classList.add('hidden');
Â  Â  Â  renderAll(true);
Â  Â  };
Â  Â  btnClosePlan.onclick = ()=> planModal.classList.add('hidden');
    
    // AutomatickÃ© nastavenie startDate pri pridanÃ­ novÃ©ho
Â  Â  btnAdd.onclick = ()=>{
Â  Â  Â  const name = addEl.value.trim();
Â  Â  Â  if(!name) return;

      // NovÃ© doplnky zaÄÃ­najÃº bez dlhÃ©ho cyklu, ale s dneÅ¡nÃ½m dÃ¡tumom
Â  Â  Â  const newIndex = supplements.push({
Â  Â  Â  Â  name,
Â  Â  Â  Â  doseQuantity: "1 ks",
Â  Â  Â  Â  doseContext: "rÃ¡no",
Â  Â  Â  Â  plan:{ days:["Po","Ut","St","Å t","Pi,So,Ne"], times:["08:30"] },
        startDate: todayISO(),
        cycleConfig: { durationWeeks: 0, pauseWeeks: 0 } 
Â  Â  Â  }) - 1; 

Â  Â  Â  addEl.value = "";
Â  Â  Â  writeLS('supplements', supplements);

Â  Â  Â  openPlan(newIndex);
Â  Â  Â  renderAll();
Â  Â  };
    
Â  Â  btnReset.onclick = ()=>{
Â  Â  Â  if (btnReset.dataset.confirm === 'true') {
Â  Â  Â  Â  localStorage.removeItem('supplements');
Â  Â  Â  Â  localStorage.removeItem('history');
Â  Â  Â  Â  location.reload();
Â  Â  Â  } else {
Â  Â  Â  Â  btnReset.textContent = "KLIKNI ZNOVA PRE POTVRDENIE (Resetuje VÅ ETKO)!";
Â  Â  Â  Â  btnReset.dataset.confirm = 'true';
Â  Â  Â  Â  setTimeout(()=>{ btnReset.textContent="ğŸ” ResetovaÅ¥ dÃ¡ta"; btnReset.dataset.confirm='false'; }, 3000);
Â  Â  Â  }
Â  Â  };
Â  Â  /* ---------- progress + chips ---------- */
Â  Â  function renderProgress(){
Â  Â  Â  todayChips.innerHTML = "";
Â  Â  Â  const today = todayISO();
Â  Â  Â  let total=0, done=0;
Â  Â  Â  const doses=[];
Â  Â  Â  supplements.forEach(s=>{
          // Ak je v pauze, nepoÄÃ­tame dÃ¡vky na dnes
          if (getCycleStatus(s).status === 'PAUSE') return;
          
Â  Â  Â  Â  if(!s.plan.days.includes(todayShort())) return;
Â  Â  Â  Â  s.plan.times.forEach(t=>{
Â  Â  Â  Â  Â  const was = !!(history[today] && history[today][s.name] && history[today][s.name][t]);
Â  Â  Â  Â  Â  doses.push({name:s.name,time:t,was});
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  Â  doses.sort((a,b)=> a.time===b.time ? a.name.localeCompare(b.name) : a.time<b.time?-1:1);
Â  Â  Â  doses.forEach(d=>{
Â  Â  Â  Â  total++; if(d.was) done++;
Â  Â  Â  Â  const chip=document.createElement('span');
Â  Â  Â  Â  chip.className = `pill ${d.was?'dosage':'time'}`;
Â  Â  Â  Â  chip.textContent = `${d.name} â€¢ ${d.time}${d.was?' âœ“':''}`;
Â  Â  Â  Â  todayChips.appendChild(chip);
Â  Â  Â  });
Â  Â  Â  const pct = total? Math.round(done/total*100):0;
Â  Â  Â  const C = 2*Math.PI*54;
Â  Â  Â  progressCircle.setAttribute('stroke-dasharray',C);
Â  Â  Â  progressCircle.setAttribute('stroke-dashoffset', C*(1-pct/100));
Â  Â  Â  progressLabel.textContent = `${pct}%`;
Â  Â  Â  if (!dayStatus.dataset.isError){
Â  Â  Â  Â  const weekday = new Date().toLocaleDateString('sk-SK',{weekday:'long'});
Â  Â  Â  Â  dayStatus.textContent = `ğŸ“… ${weekday} â€” splnenÃ© ${done}/${total} dÃ¡vok`;
Â  Â  Â  }
Â  Â  }
Â  Â  /* ---------- NOVÃ FUNKCIA: render vizuÃ¡lny deÅˆ ---------- */
Â  Â  function renderDayDisplay() {
Â  Â  Â  dayDisplay.innerHTML = "";
Â  Â  Â  const currentShortDay = todayShort(); // e.g., "Ut"
Â  Â  Â  
Â  Â  Â  dayShorts.forEach(d => {
Â  Â  Â  Â  const isToday = d === currentShortDay;
Â  Â  Â  Â  const classes = isToday
Â  Â  Â  Â  Â  Â  ? "bg-indigo-600 text-white shadow-lg transform scale-102"
Â  Â  Â  Â  Â  Â  : "bg-gray-100 text-gray-700 hover:bg-indigo-50 hover:text-indigo-700";
Â  Â  Â  Â  
Â  Â  Â  Â  const dayEl = document.createElement('div');
Â  Â  Â  Â  dayEl.className = `day-cell-compact ${classes} p-2 rounded-lg transition duration-200`;
Â  Â  Â  Â  dayEl.textContent = d;
Â  Â  Â  Â  dayDisplay.appendChild(dayEl);
Â  Â  Â  });
Â  Â  }
Â  Â  /* ---------- notifications (OPRAVENÃ ODPORÃšÄŒANÃ VERZIA S LOGOVANÃM) ---------- */
Â  Â  btnNotif.onclick = async()=>{
Â  Â  Â  console.log('NotifikÃ¡cie: Kliknutie na tlaÄidlo zachytenÃ©.');
Â  Â  Â  try {
Â  Â  Â  Â  const perm = await Notification.requestPermission();

Â  Â  Â  Â  if(perm!=='granted'){
Â  Â  Â  Â  Â  console.error('NotifikÃ¡cie zamietnutÃ© alebo blokovanÃ©.');
Â  Â  Â  Â  Â  dayStatus.textContent = "âŒ NotifikÃ¡cie: PovoÄ¾ ich v nastaveniach prehliadaÄa (alebo iPhonu/Androidu).";
Â  Â  Â  Â  Â  dayStatus.dataset.isError = 'true';
Â  Â  Â  Â  Â  setTimeout(()=>{ dayStatus.dataset.isError=''; renderProgress(); }, 5000);
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  console.log('NotifikÃ¡cie povolenÃ©, plÃ¡novanie...');
Â  Â  Â  Â  scheduleTodayNotifications();
Â  Â  Â  Â  // Vytvorenie prvej testovacej notifikÃ¡cie
Â  Â  Â  Â  new Notification("ğŸ”” NotifikÃ¡cie povolenÃ©",{body:"Budem ti pripomÃ­naÅ¥ tvoje Äasy."});

Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  // ZachytÃ¡vanie chÃ½b, ak volanie funkcie Notification zlyhÃ¡ (napr. v reÅ¡triktÃ­vnych prehliadaÄoch)
Â  Â  Â  Â  Â  console.error('Chyba pri pokuse o povolenie notifikÃ¡ciÃ­:', error);
Â  Â  Â  Â  Â  dayStatus.textContent = "âŒ Chyba pri notifikÃ¡ciÃ¡ch. Skontroluj konzolu pre detaily.";
Â  Â  Â  Â  Â  dayStatus.dataset.isError = 'true';
Â  Â  Â  Â  Â  setTimeout(()=>{ dayStatus.dataset.isError=''; renderProgress(); }, 5000);
Â  Â  Â  }
Â  Â  };
Â  Â  function scheduleTodayNotifications(){
Â  Â  Â  if(Notification.permission!=='granted') return;
Â  Â  Â  const now = new Date();
Â  Â  Â  supplements.forEach(s=>{
          // Ak je v pauze, notifikÃ¡cie nevytvÃ¡rame
          if (getCycleStatus(s).status === 'PAUSE') return; 
          
Â  Â  Â  Â  if(!s.plan.days.includes(todayShort())) return;
Â  Â  Â  Â  s.plan.times.forEach(t=>{
Â  Â  Â  Â  Â  const [h,m]=t.split(':').map(Number);
Â  Â  Â  Â  Â  const at=new Date(); at.setHours(h,m,0,0);
Â  Â  Â  Â  Â  if(at<=now) return;
Â  Â  Â  Â  Â  const delay=at-now;
Â  Â  Â  Â  Â  setTimeout(()=>{
Â  Â  Â  Â  Â  Â  const was = history[todayISO()] && history[todayISO()][s.name] && history[todayISO()][s.name][t];
Â  Â  Â  Â  Â  Â  if(!was) new Notification("ğŸ’Š Pripomienka",{body:`${s.name} â€¢ ${t}`});
Â  Â  Â  Â  Â  }, delay);
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }
Â  Â  /* ---------- SW ---------- */
Â  Â  function registerServiceWorker(){
Â  Â  Â  if('serviceWorker' in navigator){
Â  Â  Â  Â  navigator.serviceWorker.register('./sw.js').catch(console.error);
Â  Â  Â  }
Â  Â  }
Â  Â  /* ---------- render all ---------- */
Â  Â  function renderAll(fromPlanSave=false){
        initializeSupplements(); // Prebehne vÅ¾dy, aby sa zabezpeÄil startDate
Â  Â  Â  renderSupplements();
Â  Â  Â  renderDayDisplay(); 
Â  Â  Â  renderProgress();
Â  Â  Â  if(fromPlanSave) scheduleTodayNotifications();
Â  Â  }
Â  Â  window.addEventListener('load', ()=>{
Â  Â  Â  renderAll();
Â  Â  Â  if(Notification && Notification.permission==='granted') scheduleTodayNotifications();
Â  Â  Â  registerServiceWorker();
Â  Â  });
Â  </script>
</body>
</html>

